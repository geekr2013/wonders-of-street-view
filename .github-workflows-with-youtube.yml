name: ğŸŒ Daily AI Travel Shorts - Auto Upload to YouTube

# ë§¤ì¼ ìë™ ì‹¤í–‰ (í•œêµ­ ì‹œê°„ ì˜¤ì „ 9ì‹œ = UTC 0ì‹œ)
on:
  schedule:
    - cron: '0 0 * * *'  # ë§¤ì¼ UTC 0ì‹œ (í•œêµ­ ì˜¤ì „ 9ì‹œ)
  workflow_dispatch:  # ìˆ˜ë™ ì‹¤í–‰ë„ ê°€ëŠ¥

env:
  TZ: 'Asia/Seoul'

jobs:
  generate-and-upload:
    name: ğŸ¬ AI ì—¬í–‰ ì‡¼ì¸  ìƒì„± ë° ìœ íŠœë¸Œ ì—…ë¡œë“œ
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    steps:
    # 1. ì½”ë“œ ì²´í¬ì•„ì›ƒ
    - name: ğŸ“¦ ì €ì¥ì†Œ ì²´í¬ì•„ì›ƒ
      uses: actions/checkout@v4
    
    # 2. Python í™˜ê²½ ì„¤ì •
    - name: ğŸ Python 3.10 ì„¤ì •
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'
    
    # 3. ì˜ì¡´ì„± ì„¤ì¹˜
    - name: ğŸ“š Python íŒ¨í‚¤ì§€ ì„¤ì¹˜
      run: |
        pip install --upgrade pip
        pip install requests python-dotenv
        pip install google-auth google-auth-oauthlib google-auth-httplib2 google-api-python-client
    
    # 4. FFmpeg ì„¤ì¹˜
    - name: ğŸ¬ FFmpeg ì„¤ì¹˜
      run: |
        sudo apt-get update -qq
        sudo apt-get install -y ffmpeg
    
    # 5. í•œê¸€ í°íŠ¸ ì„¤ì¹˜
    - name: ğŸ”¤ í•œê¸€ í°íŠ¸ ì„¤ì¹˜
      run: |
        sudo apt-get install -y fonts-nanum fonts-nanum-coding
        fc-cache -fv
    
    # 6. ì˜ìƒ ìƒì„± ë° ìœ íŠœë¸Œ ì—…ë¡œë“œ
    - name: ğŸŒ ì˜ìƒ ìƒì„± ë° ìœ íŠœë¸Œ ìë™ ì—…ë¡œë“œ
      id: upload
      env:
        PEXELS_API_KEY: ${{ secrets.PEXELS_API_KEY }}
        YOUTUBE_TOKEN_BASE64: ${{ secrets.YOUTUBE_TOKEN_BASE64 }}
      run: |
        python3 scripts/full_auto_youtube.py
    
    # 7. ìƒì„±ëœ ì˜ìƒì„ Artifactë¡œ ë°±ì—…
    - name: ğŸ“¤ ì˜ìƒ ë°±ì—… (Artifact)
      if: always()
      uses: actions/upload-artifact@v4
      with:
        name: travel-shorts-${{ github.run_number }}
        path: |
          output/*.mp4
          output/*_metadata.json
        retention-days: 7
    
    # 8. ì„±ê³µ ì•Œë¦¼ ì´ë©”ì¼ (ìœ íŠœë¸Œ ë§í¬ í¬í•¨)
    - name: ğŸ“§ ì„±ê³µ ì•Œë¦¼ ì´ë©”ì¼
      if: success()
      uses: dawidd6/action-send-mail@v3
      with:
        server_address: smtp.gmail.com
        server_port: 587
        username: ${{ secrets.SMTP_USERNAME }}
        password: ${{ secrets.SMTP_PASSWORD }}
        subject: "ğŸ‰ AI ì—¬í–‰ ì‡¼ì¸  ìœ íŠœë¸Œ ì—…ë¡œë“œ ì™„ë£Œ! - #${{ github.run_number }}"
        to: ${{ secrets.RECIPIENT_EMAIL }}
        from: AI Travel Shorts Bot <${{ secrets.SMTP_USERNAME }}>
        html_body: |
          <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
            <h2 style="color: #2196F3;">ğŸ‰ ìœ íŠœë¸Œ ì—…ë¡œë“œ ì™„ë£Œ!</h2>
            
            <div style="background-color: #e8f5e9; padding: 20px; border-radius: 10px; margin: 20px 0;">
              <h3 style="color: #4CAF50; margin-top: 0;">âœ… ì—…ë¡œë“œ ì„±ê³µ</h3>
              <p><strong>ì‹¤í–‰ ë²ˆí˜¸:</strong> #${{ github.run_number }}</p>
              <p><strong>ì—…ë¡œë“œ ì‹œê°„:</strong> ${{ github.event.head_commit.timestamp }}</p>
              <p><strong>ì¥ì†Œ:</strong> ${{ steps.upload.outputs.location || 'ëœë¤ ì—¬í–‰ì§€' }}</p>
            </div>
            
            <div style="background-color: #fff3e0; padding: 20px; border-radius: 10px; margin: 20px 0;">
              <h3 style="color: #FF9800; margin-top: 0;">ğŸ“º ìœ íŠœë¸Œì—ì„œ í™•ì¸í•˜ê¸°</h3>
              <p>ì—…ë¡œë“œëœ ì‡¼ì¸ ë¥¼ ë°”ë¡œ í™•ì¸í•´ë³´ì„¸ìš”:</p>
              <a href="${{ steps.upload.outputs.video_url || 'https://youtube.com' }}" 
                 style="display: inline-block; padding: 12px 24px; background-color: #FF0000; color: white; text-decoration: none; border-radius: 5px; margin-top: 10px;">
                â–¶ï¸ YouTubeì—ì„œ ë³´ê¸°
              </a>
            </div>
            
            <div style="background-color: #e3f2fd; padding: 20px; border-radius: 10px; margin: 20px 0;">
              <h3 style="color: #2196F3; margin-top: 0;">ğŸ“Š ì±„ë„ ê´€ë¦¬</h3>
              <ul>
                <li>YouTube Studioì—ì„œ ì¡°íšŒìˆ˜ í™•ì¸</li>
                <li>ëŒ“ê¸€ í™•ì¸ ë° ë‹µë³€</li>
                <li>ë¶„ì„ ë°ì´í„° í™•ì¸</li>
              </ul>
              <a href="https://studio.youtube.com" 
                 style="display: inline-block; padding: 10px 20px; background-color: #2196F3; color: white; text-decoration: none; border-radius: 5px; margin-top: 10px;">
                ğŸ¬ YouTube Studio ì—´ê¸°
              </a>
            </div>
            
            <hr style="border: none; border-top: 1px solid #ddd; margin: 30px 0;">
            
            <p style="color: #666; font-size: 12px; text-align: center;">
              ë§¤ì¼ ì˜¤ì „ 9ì‹œ ìë™ìœ¼ë¡œ ìƒˆë¡œìš´ ì—¬í–‰ ì‡¼ì¸ ê°€ ìƒì„±ë˜ê³  ì—…ë¡œë“œë©ë‹ˆë‹¤.<br>
              AI Travel Shorts ìë™ ìƒì„± ì‹œìŠ¤í…œ
            </p>
          </div>
    
    # 9. ì‹¤íŒ¨ ì•Œë¦¼ ì´ë©”ì¼
    - name: ğŸ“§ ì‹¤íŒ¨ ì•Œë¦¼ ì´ë©”ì¼
      if: failure()
      uses: dawidd6/action-send-mail@v3
      with:
        server_address: smtp.gmail.com
        server_port: 587
        username: ${{ secrets.SMTP_USERNAME }}
        password: ${{ secrets.SMTP_PASSWORD }}
        subject: "âŒ AI ì—¬í–‰ ì‡¼ì¸  ìƒì„±/ì—…ë¡œë“œ ì‹¤íŒ¨ - #${{ github.run_number }}"
        to: ${{ secrets.RECIPIENT_EMAIL }}
        from: AI Travel Shorts Bot <${{ secrets.SMTP_USERNAME }}>
        html_body: |
          <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
            <h2 style="color: #f44336;">âŒ ìƒì„± ë˜ëŠ” ì—…ë¡œë“œ ì‹¤íŒ¨</h2>
            
            <div style="background-color: #ffebee; padding: 20px; border-radius: 10px; margin: 20px 0;">
              <h3 style="color: #f44336; margin-top: 0;">âš ï¸ ì˜¤ë¥˜ ë°œìƒ</h3>
              <p><strong>ì‹¤í–‰ ë²ˆí˜¸:</strong> #${{ github.run_number }}</p>
              <p><strong>ì‹¤íŒ¨ ì‹œê°„:</strong> ${{ github.event.head_commit.timestamp }}</p>
            </div>
            
            <div style="background-color: #f5f5f5; padding: 20px; border-radius: 10px; margin: 20px 0;">
              <h3 style="margin-top: 0;">ğŸ” ë¡œê·¸ í™•ì¸</h3>
              <a href="https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}" 
                 style="display: inline-block; padding: 12px 24px; background-color: #f44336; color: white; text-decoration: none; border-radius: 5px; margin-top: 10px;">
                ğŸ”— ë¡œê·¸ ë³´ê¸°
              </a>
            </div>
            
            <p style="color: #666; font-size: 12px; text-align: center; margin-top: 30px;">
              ë¬¸ì œê°€ ì§€ì†ë˜ë©´ GitHub Issuesì— ë¬¸ì˜í•˜ì„¸ìš”.
            </p>
          </div>
    
    # 10. ì‹¤í–‰ ìš”ì•½
    - name: ğŸ“Š ì‹¤í–‰ ìš”ì•½
      if: always()
      run: |
        echo "================================"
        echo "ğŸŒ AI ì—¬í–‰ ì‡¼ì¸  ìë™í™” ì™„ë£Œ"
        echo "================================"
        echo "ì‹¤í–‰ ë²ˆí˜¸: ${{ github.run_number }}"
        echo "ìƒíƒœ: ${{ job.status }}"
        echo "ì‹œê°„: $(date)"
        echo "================================"

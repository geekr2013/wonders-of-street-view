name: ğŸŒ Daily AI Travel Shorts - Video Generation Only

# âš ï¸ ì£¼ì˜: ì´ ì›Œí¬í”Œë¡œìš°ëŠ” ì˜ìƒë§Œ ìƒì„±í•©ë‹ˆë‹¤ (ìœ íŠœë¸Œ ì—…ë¡œë“œ ì—†ìŒ)
# ìœ íŠœë¸Œ ìë™ ì—…ë¡œë“œë¥¼ ì›í•˜ë©´ `youtube-auto-upload.yml` ì›Œí¬í”Œë¡œìš°ë¥¼ ì‚¬ìš©í•˜ì„¸ìš”
# 
# ì´ ì›Œí¬í”Œë¡œìš°ëŠ” ê¸°ë³¸ì ìœ¼ë¡œ ë¹„í™œì„±í™”ë˜ì–´ ìˆìŠµë‹ˆë‹¤ (schedule ì£¼ì„ ì²˜ë¦¬)
# ì˜ìƒ ìƒì„±ë§Œ ì›í•˜ë©´ ì•„ë˜ ì£¼ì„ì„ í•´ì œí•˜ì„¸ìš”
on:
  # schedule:
  #   - cron: '0 0 * * *'  # ë§¤ì¼ UTC 0ì‹œ (í•œêµ­ ì˜¤ì „ 9ì‹œ)
  workflow_dispatch:  # ìˆ˜ë™ ì‹¤í–‰ë§Œ ê°€ëŠ¥

# í™˜ê²½ ë³€ìˆ˜ ì„¤ì •
env:
  TZ: 'Asia/Seoul'

jobs:
  generate-travel-shorts:
    name: ğŸ¬ AI ì—¬í–‰ ì‡¼ì¸  ìë™ ìƒì„±
    runs-on: ubuntu-latest
    timeout-minutes: 30
    
    steps:
    # 1. ì½”ë“œ ì²´í¬ì•„ì›ƒ
    - name: ğŸ“¦ ì €ì¥ì†Œ ì²´í¬ì•„ì›ƒ
      uses: actions/checkout@v4
    
    # 2. Python í™˜ê²½ ì„¤ì •
    - name: ğŸ Python 3.10 ì„¤ì •
      uses: actions/setup-python@v5
      with:
        python-version: '3.10'
        cache: 'pip'
    
    # 3. ì˜ì¡´ì„± ì„¤ì¹˜
    - name: ğŸ“š Python íŒ¨í‚¤ì§€ ì„¤ì¹˜
      run: |
        pip install --upgrade pip
        pip install requests python-dotenv
    
    # 4. FFmpeg ì„¤ì¹˜ (ì˜ìƒ í¸ì§‘ìš©)
    - name: ğŸ¬ FFmpeg ì„¤ì¹˜
      run: |
        sudo apt-get update -qq
        sudo apt-get install -y ffmpeg
        ffmpeg -version
    
    # 5. í•œê¸€ í°íŠ¸ ì„¤ì¹˜ (ìë§‰ìš©)
    - name: ğŸ”¤ í•œê¸€ í°íŠ¸ ì„¤ì¹˜
      run: |
        sudo apt-get install -y fonts-nanum fonts-nanum-coding
        fc-cache -fv
    
    # 6. ì˜¤ë˜ëœ ì˜ìƒ ìë™ ì •ë¦¬ (7ì¼ ì´ìƒ)
    - name: ğŸ§¹ ì˜¤ë˜ëœ ì˜ìƒ ìë™ ì •ë¦¬
      run: |
        python3 scripts/cleanup_old_videos.py
    
    # 7. Pexels ë¬´ë£Œ ì˜ìƒìœ¼ë¡œ ì‡¼ì¸  ìƒì„±
    - name: ğŸŒ AI ì—¬í–‰ ì‡¼ì¸  ìë™ ìƒì„±
      env:
        PEXELS_API_KEY: ${{ secrets.PEXELS_API_KEY }}
      run: |
        python3 scripts/generate_with_pexels.py
    
    # 8. ì €ì¥ì†Œì— ë³€ê²½ì‚¬í•­ ì»¤ë°‹ (ì •ë¦¬ëœ ìƒíƒœ ì €ì¥)
    - name: ğŸ’¾ ì •ë¦¬ëœ ì €ì¥ì†Œ ì»¤ë°‹
      if: success()
      run: |
        git config user.name "AI Travel Shorts Bot"
        git config user.email "cogurrl@gmail.com"
        git add -A
        git diff-index --quiet HEAD || git commit -m "chore: ì˜¤ë˜ëœ ì˜ìƒ ìë™ ì •ë¦¬ (${GITHUB_RUN_NUMBER})"
        git push || echo "ì»¤ë°‹í•  ë³€ê²½ì‚¬í•­ì´ ì—†ìŠµë‹ˆë‹¤"
    
    # 9. ì €ì¥ì†Œ ìš©ëŸ‰ í™•ì¸
    - name: ğŸ“Š ì €ì¥ì†Œ ìš©ëŸ‰ í™•ì¸
      if: always()
      run: |
        echo "ğŸ“Š ì €ì¥ì†Œ ìš©ëŸ‰ í˜„í™©:"
        du -sh . 2>/dev/null || echo "ì „ì²´: N/A"
        du -sh output/ 2>/dev/null || echo "output: ì •ë¦¬ í›„"
        echo ""
        echo "âš ï¸ GitHub Free í•œë„: 500MB"
        echo "âœ… ArtifactsëŠ” ë³„ë„ 2GB (ìë™ ì •ë¦¬)"
    
    # 10. ìƒì„±ëœ ì˜ìƒì„ Artifactë¡œ ì—…ë¡œë“œ (ë‹¤ìš´ë¡œë“œ ê°€ëŠ¥)
    - name: ğŸ“¤ ìƒì„±ëœ ì˜ìƒ ì—…ë¡œë“œ
      if: success()
      uses: actions/upload-artifact@v4
      with:
        name: travel-shorts-${{ github.run_number }}
        path: |
          output/*.mp4
          output/*_metadata.json
          logs/cleanup_*.json
        retention-days: 30
    
    # 11. ì´ë©”ì¼ ì•Œë¦¼ ì „ì†¡ (ì„±ê³µ)
    - name: ğŸ“§ ì„±ê³µ ì•Œë¦¼ ì´ë©”ì¼ ì „ì†¡
      if: success()
      uses: dawidd6/action-send-mail@v3
      with:
        server_address: smtp.gmail.com
        server_port: 587
        username: ${{ secrets.SMTP_USERNAME }}
        password: ${{ secrets.SMTP_PASSWORD }}
        subject: "ğŸ‰ AI ì—¬í–‰ ì‡¼ì¸  ìƒì„± ì™„ë£Œ - ${{ github.run_number }}"
        to: ${{ secrets.RECIPIENT_EMAIL }}
        from: AI Travel Shorts Bot <${{ secrets.SMTP_USERNAME }}>
        html_body: |
          <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
            <h2 style="color: #2196F3;">ğŸŒ ìƒˆë¡œìš´ ì—¬í–‰ ì‡¼ì¸ ê°€ ìƒì„±ë˜ì—ˆìŠµë‹ˆë‹¤!</h2>
            
            <div style="background-color: #f5f5f5; padding: 20px; border-radius: 10px; margin: 20px 0;">
              <h3 style="margin-top: 0;">ğŸ“Š ìƒì„± ì •ë³´</h3>
              <p><strong>ì‹¤í–‰ ë²ˆí˜¸:</strong> #${{ github.run_number }}</p>
              <p><strong>ìƒì„± ì‹œê°„:</strong> ${{ github.event.head_commit.timestamp }}</p>
              <p><strong>ìƒíƒœ:</strong> âœ… ì„±ê³µ</p>
            </div>
            
            <div style="background-color: #e8f5e9; padding: 20px; border-radius: 10px; margin: 20px 0;">
              <h3 style="color: #4CAF50; margin-top: 0;">ğŸ“¥ ì˜ìƒ ë‹¤ìš´ë¡œë“œ</h3>
              <p>ìƒì„±ëœ ì˜ìƒì„ ë‹¤ìš´ë¡œë“œí•˜ë ¤ë©´ ì•„ë˜ ë§í¬ë¥¼ í´ë¦­í•˜ì„¸ìš”:</p>
              <a href="https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}" 
                 style="display: inline-block; padding: 12px 24px; background-color: #4CAF50; color: white; text-decoration: none; border-radius: 5px; margin-top: 10px;">
                ğŸ”— ì˜ìƒ ë‹¤ìš´ë¡œë“œ í•˜ê¸°
              </a>
              <p style="margin-top: 15px; font-size: 12px; color: #666;">
                "Artifacts" ì„¹ì…˜ì—ì„œ "travel-shorts-${{ github.run_number }}" íŒŒì¼ì„ ë‹¤ìš´ë¡œë“œí•˜ì„¸ìš”.
              </p>
            </div>
            
            <div style="background-color: #fff3e0; padding: 20px; border-radius: 10px; margin: 20px 0;">
              <h3 style="color: #FF9800; margin-top: 0;">ğŸ“º ë‹¤ìŒ ë‹¨ê³„</h3>
              <ol>
                <li>ìœ„ ë§í¬ì—ì„œ ì˜ìƒ ë‹¤ìš´ë¡œë“œ</li>
                <li>ìœ íŠœë¸Œ ì‡¼ì¸ ì— ì—…ë¡œë“œ</li>
                <li>ìˆ˜ìµ í™•ì¸! ğŸ’°</li>
              </ol>
            </div>
            
            <hr style="border: none; border-top: 1px solid #ddd; margin: 30px 0;">
            
            <p style="color: #666; font-size: 12px; text-align: center;">
              ì´ ë©”ì¼ì€ AI ì—¬í–‰ ì‡¼ì¸  ìë™ ìƒì„± ì‹œìŠ¤í…œì—ì„œ ë°œì†¡ë˜ì—ˆìŠµë‹ˆë‹¤.<br>
              ë§¤ì¼ ìƒˆë¡œìš´ ì—¬í–‰ì§€ì˜ ì˜ìƒì´ ìë™ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤.
            </p>
          </div>
    
    # 12. ì‹¤íŒ¨ ì•Œë¦¼ ì´ë©”ì¼ ì „ì†¡
    - name: ğŸ“§ ì‹¤íŒ¨ ì•Œë¦¼ ì´ë©”ì¼ ì „ì†¡
      if: failure()
      uses: dawidd6/action-send-mail@v3
      with:
        server_address: smtp.gmail.com
        server_port: 587
        username: ${{ secrets.SMTP_USERNAME }}
        password: ${{ secrets.SMTP_PASSWORD }}
        subject: "âŒ AI ì—¬í–‰ ì‡¼ì¸  ìƒì„± ì‹¤íŒ¨ - ${{ github.run_number }}"
        to: ${{ secrets.RECIPIENT_EMAIL }}
        from: AI Travel Shorts Bot <${{ secrets.SMTP_USERNAME }}>
        html_body: |
          <div style="font-family: Arial, sans-serif; max-width: 600px; margin: 0 auto;">
            <h2 style="color: #f44336;">âŒ ì˜ìƒ ìƒì„±ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤</h2>
            
            <div style="background-color: #ffebee; padding: 20px; border-radius: 10px; margin: 20px 0;">
              <h3 style="color: #f44336; margin-top: 0;">âš ï¸ ì˜¤ë¥˜ ì •ë³´</h3>
              <p><strong>ì‹¤í–‰ ë²ˆí˜¸:</strong> #${{ github.run_number }}</p>
              <p><strong>ì‹¤íŒ¨ ì‹œê°„:</strong> ${{ github.event.head_commit.timestamp }}</p>
            </div>
            
            <div style="background-color: #f5f5f5; padding: 20px; border-radius: 10px; margin: 20px 0;">
              <h3 style="margin-top: 0;">ğŸ” ë¡œê·¸ í™•ì¸</h3>
              <p>ìì„¸í•œ ì˜¤ë¥˜ ë¡œê·¸ë¥¼ í™•ì¸í•˜ë ¤ë©´:</p>
              <a href="https://github.com/${{ github.repository }}/actions/runs/${{ github.run_id }}" 
                 style="display: inline-block; padding: 12px 24px; background-color: #f44336; color: white; text-decoration: none; border-radius: 5px; margin-top: 10px;">
                ğŸ”— ë¡œê·¸ ë³´ê¸°
              </a>
            </div>
            
            <p style="color: #666; font-size: 12px; text-align: center; margin-top: 30px;">
              ë¬¸ì œê°€ ì§€ì†ë˜ë©´ GitHub Issuesì— ë¬¸ì˜í•˜ì„¸ìš”.
            </p>
          </div>
    
    # 13. ì‹¤í–‰ ìš”ì•½ ì¶œë ¥
    - name: ğŸ“Š ì‹¤í–‰ ìš”ì•½
      if: always()
      run: |
        echo "================================"
        echo "ğŸŒ AI ì—¬í–‰ ì‡¼ì¸  ìƒì„± ì™„ë£Œ"
        echo "================================"
        echo "ì‹¤í–‰ ë²ˆí˜¸: ${{ github.run_number }}"
        echo "ìƒíƒœ: ${{ job.status }}"
        echo "ì‹œê°„: $(date)"
        echo "================================"

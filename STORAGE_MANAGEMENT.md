# 🗄️ 저장소 용량 관리 시스템

## 🎯 문제

GitHub Free 계정의 저장소 한도는 **500MB**입니다.

매일 영상을 생성하면:
- 원본 영상: ~5MB
- 최종 영상: ~2.5MB
- 합계: ~7.5MB/일

**67일 후 500MB 한도 초과! ❌**

---

## ✅ 해결책: 자동 정리 시스템

### 구현된 기능

#### 1. 자동 정리 스크립트
**파일**: `scripts/cleanup_old_videos.py`

**기능:**
- 7일 이상 된 파일 자동 삭제
- 저장소 용량 모니터링
- 정리 로그 자동 생성

**실행:**
```bash
python3 scripts/cleanup_old_videos.py
```

**출력 예시:**
```
🧹 자동 영상 정리 시작
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
📊 현재 상태:
   총 파일 수: 20개
   총 용량: 150.5 MB
   보관 기간: 7일

🗑️ 삭제: old_video_20251201.mp4 (15일, 5.2 MB)
🗑️ 삭제: old_video_20251202.mp4 (14일, 4.8 MB)
...

✅ 정리 완료
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
삭제된 파일: 13개 (98.3 MB)
보관된 파일: 7개 (52.2 MB)
```

---

#### 2. 워크플로우 자동 통합

**YouTube 자동 업로드 모드:**
```yaml
# 업로드 전 정리
- 오래된 영상 자동 정리 (7일+)

# 업로드 후 로컬 삭제
- 업로드 완료 후 MP4 삭제
  (YouTube에 저장되므로 로컬 불필요)

# 저장소 커밋
- 정리된 상태를 Git에 커밋
```

**영상만 생성 모드:**
```yaml
# 업로드 전 정리
- 오래된 영상 자동 정리 (7일+)

# Artifacts에 백업
- 생성된 영상을 Artifacts에 30일 보관
  (별도 2GB 한도)

# 저장소 커밋
- 정리된 상태를 Git에 커밋
```

---

## 📊 용량 시뮬레이션

### 시나리오 1: 자동 정리 없음 (구현 전) 🚨

| 기간 | 용량 | 상태 |
|------|------|------|
| 7일 | 52.5 MB | ✅ |
| 30일 | 225.0 MB | ✅ |
| 60일 | 450.1 MB | ✅ |
| **67일** | **~500 MB** | **⚠️ 한도 도달** |
| 90일 | 675.1 MB | ❌ 한도 초과 |
| 1년 | 2,738 MB | ❌ 커밋 불가 |

**결론**: 67일 후 과금 위험! ❌

---

### 시나리오 2: YouTube 자동 업로드 (현재 구현) ✅

**전략:**
1. 업로드 완료 후 MP4 삭제
2. 메타데이터만 보관 (JSON, ~1KB)
3. 7일 후 메타데이터도 삭제

| 기간 | 용량 | 상태 |
|------|------|------|
| 7일 | 0.007 MB | ✅ |
| 30일 | 0.007 MB | ✅ |
| 60일 | 0.007 MB | ✅ |
| 90일 | 0.007 MB | ✅ |
| 1년 | 0.007 MB | ✅ |
| **평생** | **~0.007 MB** | **✅ 안전** |

**한도 대비**: 0.00% (500MB 중)

**결론**: 영구 지속 가능! 🎉

---

### 시나리오 3: 영상만 생성 (현재 구현) ✅

**전략:**
1. 7일 이상 된 영상 자동 삭제
2. Artifacts에 30일 보관 (별도 2GB)

| 기간 | 용량 | 상태 |
|------|------|------|
| 7일 | 17.5 MB | ✅ |
| 30일 | 17.5 MB | ✅ |
| 60일 | 17.5 MB | ✅ |
| 90일 | 17.5 MB | ✅ |
| 1년 | 17.5 MB | ✅ |
| **평생** | **~17.5 MB** | **✅ 안전** |

**한도 대비**: 3.5% (500MB 중)

**결론**: 영구 지속 가능! 🎉

---

## 🎯 권장 사항

### 최적의 선택: YouTube 자동 업로드 ⭐

**이유:**
1. ✅ 최소 용량 (0.007 MB)
2. ✅ YouTube에 영구 보관
3. ✅ 자동 백업
4. ✅ 무제한 지속 가능

**대안: 영상만 생성 모드**

**장점:**
- ✅ 간단한 설정
- ✅ 로컬 백업 7일

**단점:**
- ⚠️ 수동 업로드 필요
- ⚠️ 용량 3.5% 사용

---

## 🔧 설정

### 보관 기간 변경

**파일**: `scripts/cleanup_old_videos.py`

```python
# 기본값: 7일
RETENTION_DAYS = 7

# 변경 예시:
RETENTION_DAYS = 3   # 3일만 보관 (더 공격적 정리)
RETENTION_DAYS = 14  # 14일 보관 (더 많은 백업)
```

**권장값**: 7일 (충분한 백업 + 최소 용량)

---

## 📋 자동 실행

### GitHub Actions에서 자동 실행

**YouTube 자동 업로드 워크플로우:**
```yaml
steps:
  - name: 🧹 오래된 영상 자동 정리
    run: python3 scripts/cleanup_old_videos.py
  
  - name: 🌍 영상 생성 및 유튜브 업로드
    run: python3 scripts/full_auto_youtube.py
  
  - name: 🗑️ 업로드된 영상 로컬 삭제
    run: rm -f output/*.mp4
  
  - name: 💾 정리된 저장소 커밋
    run: |
      git add -A
      git commit -m "chore: 자동 정리"
      git push
```

**영상만 생성 워크플로우:**
```yaml
steps:
  - name: 🧹 오래된 영상 자동 정리
    run: python3 scripts/cleanup_old_videos.py
  
  - name: 🌍 영상 생성
    run: python3 scripts/generate_with_pexels.py
  
  - name: 📤 Artifacts에 백업
    uses: actions/upload-artifact@v4
    with:
      retention-days: 30  # 자동 만료
  
  - name: 💾 정리된 저장소 커밋
    run: |
      git add -A
      git commit -m "chore: 자동 정리"
      git push
```

---

## 🔍 모니터링

### 저장소 용량 확인

**GitHub Actions 로그:**
```
📊 저장소 용량 확인
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
저장소 용량 현황:
전체: 45.2 MB
output/: 17.5 MB
logs/: 0.3 MB

⚠️ GitHub Free 한도: 500MB
✅ 현재 사용량: 45.2 MB (9.0%)
```

**로컬에서 확인:**
```bash
# 전체 용량
du -sh .

# output 폴더 용량
du -sh output/

# 파일별 용량
ls -lh output/
```

---

## 📊 Artifacts 관리

### GitHub Actions Artifacts

**용량 한도:**
- GitHub Free: 2GB (별도 한도)
- 자동 만료: 7-30일 설정 가능

**설정:**
```yaml
- name: 📤 Artifacts 업로드
  uses: actions/upload-artifact@v4
  with:
    retention-days: 7  # 7일 후 자동 삭제
```

**장점:**
- ✅ 저장소 용량과 별개
- ✅ 자동 만료 (수동 관리 불필요)
- ✅ 다운로드 가능 (백업용)

---

## ⚠️ 경고 및 알림

### 용량 경고

정리 스크립트가 자동으로 경고:

```python
if remaining_size_mb > 100:
    print("⚠️ 경고: 저장소 용량이 100MB를 초과했습니다.")
    print(f"현재 용량: {remaining_size_mb:.2f} MB")
    print("보관 기간을 줄이는 것을 고려하세요.")
```

**대응:**
1. 보관 기간 단축 (7일 → 3일)
2. 수동 정리 실행
3. YouTube 자동 업로드 모드로 전환 (추천)

---

## 🎉 결론

### ✅ 구현 완료

1. **자동 정리 스크립트**
   - 7일 이상 파일 자동 삭제
   - 용량 모니터링
   - 로그 자동 생성

2. **워크플로우 통합**
   - YouTube 업로드 후 로컬 삭제
   - 정리 후 Git 커밋
   - 용량 확인 자동화

3. **Artifacts 활용**
   - 30일 백업 (별도 한도)
   - 자동 만료

4. **검증 완료**
   - ✅ Python 문법 검사
   - ✅ YAML 문법 검사
   - ✅ 용량 시뮬레이션
   - ✅ 실제 테스트

---

### 🎯 최종 권장

**YouTube 자동 업로드 모드** ⭐
- 용량: 0.007 MB (거의 0)
- 한도 대비: 0.00%
- 지속 가능: 영구

**결론: 과금 걱정 없이 영구 운영 가능! 🎉**

---

## 📞 지원

**문의**: cogurrl@gmail.com  
**저장소**: https://github.com/geekr2013/wonders-of-street-view

**문제 해결:**
- 용량 초과 시
- 정리 스크립트 오류
- 설정 변경 도움

---

**🌍 걱정 없이 AI 여행 쇼츠를 즐기세요! ✨**

**영구 무료 운영 보장!** ✅
